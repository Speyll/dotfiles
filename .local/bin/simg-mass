#!/bin/bash
set -euo pipefail

TARGET_DIR="${1:-.}"

# Recursively find all image files (jpg, jpeg, png, gif, webp)
mapfile -d '' files < <(find "$TARGET_DIR" -type f \( \
  -iname '*.jpg' -o -iname '*.jpeg' -o -iname '*.png' -o -iname '*.gif' -o -iname '*.webp' \
  \) -print0)

if ((${#files[@]} == 0)); then
  echo "No image files found in '$TARGET_DIR'" >&2
  exit 1
fi

# Shuffle the array using Fisher-Yates algorithm
for ((i=${#files[@]} - 1; i > 0; i--)); do
  j=$(( RANDOM % (i + 1) ))
  tmp=${files[i]}
  files[i]=${files[j]}
  files[j]=$tmp
done

# Pass fully shuffled image list to swayimg slideshow mode, no recursion or order args needed
swayimg --slideshow "${files[@]}"
